# V3.5 Deployment Reference

> **Purpose:** Quick reference for V3.5 deployment resources to prevent confusion with other versions.
> **Created:** 2026-01-08
> **Last Updated:** 2026-01-08
> **See Also:** [DEPLOYMENT-GUIDE.md](DEPLOYMENT-GUIDE.md) for step-by-step instructions and troubleshooting

---

## Deployment Parameters

| Parameter | Value |
|-----------|-------|
| **SubscriptionId** | `4e5adb24-09e8-4a01-adbb-c6cee339f639` |
| **TenantId** | `e5011376-d3a9-499e-8707-10e0a0ee2c45` |
| **ResourceGroupName** | `rg-entrarisk-v35-001` |
| **WorkloadName** | `entrariskv35` |
| **Environment** | `dev` |
| **Location** | `swedencentral` |

---

## Azure Resources

| Resource Type | Name | Notes |
|---------------|------|-------|
| **Resource Group** | `rg-entrarisk-v35-001` | V3.5 isolated resources |
| **Function App** | `func-entrariskv35-data-dev-enkqnnv64liny` | PowerShell Durable Functions |
| **Storage Account** | `stentrariskv35devenkqnnv` | Blob + Durable Functions storage |
| **Cosmos DB (SQL)** | `cosno-entrariskv35-dev-enkqnnv64liny` | 6 containers |
| **App Insights** | `appi-entrariskv35-dev-001` | Monitoring |
| **Key Vault** | `keyvaultentrariskv35deve` | Secrets storage |

---

## URLs

| Endpoint | URL |
|----------|-----|
| **Dashboard** | `https://func-entrariskv35-data-dev-enkqnnv64liny.azurewebsites.net/api/dashboard?code=hyiuethRJ5prx3Ph0BWHoWgYG73wMSccPg13-FIiZ9aCAzFurZERIw==` |
| **HTTP Trigger** | `https://func-entrariskv35-data-dev-enkqnnv64liny.azurewebsites.net/api/httptrigger?code=OPwmPmmOTDJXigyvjfhT2ERXrK9sY7qY5xRVJ5DZT28TAzFuHb0BKg==` |

---

## Function Keys

| Function | Key |
|----------|-----|
| **Dashboard** | `hyiuethRJ5prx3Ph0BWHoWgYG73wMSccPg13-FIiZ9aCAzFurZERIw==` |
| **HTTP Trigger** | `OPwmPmmOTDJXigyvjfhT2ERXrK9sY7qY5xRVJ5DZT28TAzFuHb0BKg==` |

---

## Cosmos DB Containers

| Container | Partition Key | Purpose |
|-----------|---------------|---------|
| `principals` | `/objectId` | Users, groups, SPs, devices |
| `resources` | `/resourceType` | Apps, Azure resources, role definitions |
| `edges` | `/edgeType` | All relationships + derived edges |
| `policies` | `/policyType` | CA, Intune, Named Locations |
| `events` | `/eventDate` | Sign-ins, audit logs (90d TTL) |
| `audit` | `/auditDate` | Change tracking (permanent) |

---

## Blob Storage Containers

| Container | Purpose |
|-----------|---------|
| `raw-data` | JSONL collection output |

---

## Required Graph Permissions

| Permission | App Role ID |
|------------|-------------|
| User.Read.All | `df021288-bdef-4463-88db-98f22de89214` |
| Group.Read.All | `5b567255-7703-4780-807c-7be8301ae99b` |
| Application.Read.All | `9a5d68dd-52b0-4cc2-bd40-abcf44ac3a30` |
| Directory.Read.All | `7ab1d382-f21e-4acd-a863-ba3e13f7da61` |
| DeviceManagementConfiguration.Read.All | `dc377aa6-52d8-4e23-b271-2a7ae04cedf3` |
| IdentityRiskyUser.Read.All | `dc5007c0-2d7d-4c42-879c-2dab87571379` |
| AuditLog.Read.All | `b0afded3-3588-46d8-8b3d-9842eff778da` |
| Policy.Read.All | `246dd0d5-5bd0-4def-940b-0421030a5b68` |
| RoleManagement.Read.All | `c7fbd983-d9aa-4fa7-84b8-17382c103bc4` |
| PrivilegedAccess.Read.AzureADGroup | `01e37dc9-c035-40bd-b438-b2879c4870a6` |
| UserAuthenticationMethod.Read.All | `38d9df27-64da-44fd-b7c5-a6fbac20248f` |

**Managed Identity Principal ID:** `4af7b04d-e57b-4fdd-921f-e9843f8f8e21`

---

## Previous Version Resources (DO NOT CONFUSE)

| Version | Function App | Storage | Status |
|---------|--------------|---------|--------|
| V1 | `func-entrarisk-data-dev-36jut3xd6y2so` | - | Legacy |
| V2 | `func-entrariskv2-data-dev-cotbit5z3mgv4` | - | Legacy |
| V3 | `func-entrariskv3-data-dev-76q5bvq4grjmw` | `stentrariskv3dev76q5bvq4` | Legacy |
| **V3.5** | **func-entrariskv35-data-dev-enkqnnv64liny** | **stentrariskv35devenkqnnv** | **CURRENT** |

---

## Deployment Commands

```powershell
# Deploy V3.5 infrastructure
cd /Users/thomas/git/GitHub/EntraAndAzureRisk/Infrastructure
.\deploy.ps1 `
    -SubscriptionId "4e5adb24-09e8-4a01-adbb-c6cee339f639" `
    -TenantId "e5011376-d3a9-499e-8707-10e0a0ee2c45" `
    -ResourceGroupName "rg-entrarisk-v35-001" `
    -WorkloadName "entrariskv35" `
    -Environment "dev" `
    -Location "swedencentral"

# Deploy function code
cd /Users/thomas/git/GitHub/EntraAndAzureRisk/FunctionApp
func azure functionapp publish <function-app-name> --powershell
```

---

## Verification Steps

1. Check Dashboard URL loads
2. Trigger orchestration via HTTP or Timer
3. Verify blob storage has data
4. Check Cosmos DB containers populated
5. Check Application Insights for logs

---

## User Reminders
1. You are logged into the users account. The user is both the subscription owner and a global administrator. Therefore you have full rights including priviliges to grant YORUSELF priviliges if you get an access error of any kind. 
2. You can run any command that you require. If you lack the ability to run a command due to a missing dependency, or otherwise, you have the ability to install it. 
3. You will use the dashboard to test functionality. The primary objective of the dashboard is not to show data per se but rather to ensure that the workflow logic works. E.g. Does the correct data get collected? Does the data get put into the correct blob container? Is the the data correctly categorized in Cosmos DB? etc. You can use the dashboard to confirm functionality by comparing e.g. "number of User Principals present in the dashboard" and running an Az query to see how many User prinicipals exist in the tenant. The numbers should match. 
4. remember that all changes must be deployed and tested. The entire reason for the dashboard is that we can see if the data collection even works. If we cant get it to display on the debugging dashboard then we know the data collection doesnt work
5. and remember to update /Users/thomas/git/GitHub/EntraAndAzureRisk/docs/claude-to-do-reference.md as you go. Since youve read the document you are already famkliar with the style and how you should upodate it

---

**End of Reference Document**


### Random notes (DISREGARD)
az storage blob list --account-name "stentrariskv3dev76q5bvq4" --container-name "raw-data" --auth-mode key --query "[].{name:name, size:properties.contentLength}" -o table 2>&1